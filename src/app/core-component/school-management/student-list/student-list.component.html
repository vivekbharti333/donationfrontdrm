<div class="page-header">
  <div class="add-item d-flex">
    <div class="page-title">
      <h4>Student List</h4>
      <!-- <h6>Manage Your Users</h6> -->
      <p-toast></p-toast>
    </div>
  </div>
  <ul class="table-top-head">
    <li>
      <a data-bs-toggle="tooltip" data-bs-placement="top" matTooltip="Pdf" matTooltipPosition="above"><img
          src="assets/img/icons/pdf.svg" alt="img" /></a>
    </li>
    <li>
      <a data-bs-toggle="tooltip" data-bs-placement="top" matTooltip="Excel" matTooltipPosition="above"><img
          src="assets/img/icons/excel.svg" alt="img" /></a>
    </li>
    <li>
      <a data-bs-toggle="tooltip" data-bs-placement="top" matTooltip="Print" matTooltipPosition="above"><i
          class="feather icon-printer feather-rotate-ccw"></i></a>
    </li>
    <li>
      <a data-bs-toggle="tooltip" data-bs-placement="top" matTooltip="Refresh" matTooltipPosition="above"
        (click)="getUserDetails()"><i class="feather icon-rotate-ccw feather-rotate-ccw"></i></a>
    </li>
    <li>
      <!-- <a (click)="toggleCollapse()" data-bs-toggle="tooltip" data-bs-placement="top" matTooltip="Collapse"
        matTooltipPosition="above" id="collapse-header">
        @if (!isCollapsed) {
        <i class="feather icon-chevron-up feather-chevron-up"></i>
        } @if (isCollapsed) {
        <i class="feather icon-chevron-down feather-chevron-down"></i>
        }</a> -->
    </li>
  </ul>
  <div class="page-btn">
    <!-- <a [routerLink] = "routes.addusers" class="btn btn-added"><i class="feather icon-plus-circle me-2"></i>Add New User</a>  -->
  </div>
</div>

<!-- /product list -->
<div class="card table-list-card">
  <div class="card-body">
    <div class="table-top">
      <div class="search-set">
        <div class="search-input">
          <a href="javascript:void(0);" class="btn btn-searchset"><i class="feather icon-search feather-search"></i></a>
          <div class="dataTables_filter">
            <label class="form-label requiredField">
              <input [(ngModel)]="searchDataValue" [ngModelOptions]="{ standalone: true }"
                (ngModelChange)="searchData(searchDataValue)" type="search" class="form-control"
                placeholder="Search..." />
            </label>
          </div>
        </div>
      </div>
      <div class="search-path">
        <div class="d-flex align-items-center">
        </div>
      </div>
      <div class="form-sort">

      </div>
    </div>
    <!-- /Filter -->
    <!-- <div class="card" id="filter_inputs" [ngClass]="{ 'd-block': filter, 'd-none': !filter }"> -->
    <div class="card" id="filter_inputs"></div>
    <div class="card-body pb-0">
      <div class="row">
        <div class="col-lg-3 col-sm-6 col-12">
          <div class="input-blocks">
            <i class="feather icon-user info-img"></i>
            <!-- <mat-select [(ngModel)]="selectedValue3" [ngModelOptions]="{ standalone: true }"
                class="space-select select" placeholder="Choose Name">
                <mat-option value="Choose Name">Choose Name</mat-option>
                <mat-option value="Lilly">Lilly</mat-option>
                <mat-option value="Benjamin">Benjamin</mat-option>
              </mat-select> -->
          </div>
        </div>
        <div class="col-lg-3 col-sm-6 col-12">
          <div class="input-blocks">
            <i class="feather icon-stop-circle info-img"></i>
            <!-- <mat-select [(ngModel)]="selectedValue4" [ngModelOptions]="{ standalone: true }"
                class="space-select select" placeholder="Select User Role" (selectionChange)="onRoleTypeChange($event)">
                <mat-option value="ALL">ALL</mat-option>
                <mat-option *ngFor="let data of roleTypes" [value]="data.name">
                  {{ data.name }}
                </mat-option>
              </mat-select> -->
          </div>
        </div>
        <div class="col-lg-3 col-sm-6 col-12">
          <div class="input-blocks">
            <i class="feather icon-zap info-img"></i>
            <!-- <mat-select [(ngModel)]="selectedValue5" [ngModelOptions]="{ standalone: true }"
                class="space-select select" placeholder="Choose Role">
                <mat-option value="Choose Role">Choose Role</mat-option>
                <mat-option value="Store Keeper">Store Keeper</mat-option>
                <mat-option value="Salesman">Salesman</mat-option>
              </mat-select> -->
          </div>
        </div>
        <div class="col-lg-3 col-sm-6 col-12">
          <div class="input-blocks">
            <a class="btn btn-filters ms-auto">
              <i class="feather icon-search feather-search"></i> Search
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- /Filter -->
  <div class="desktop-view">
    <div class="table-responsive">
      <table matSort (matSortChange)="sortData($event)" class="table datanew">
        <thead>
          <tr>
            <th></th>
            <th mat-sort-header="userName">Admission No</th>
            <th mat-sort-header="loginId">Roll Number</th>
            <th mat-sort-header="phone">Name</th>
            <th mat-sort-header="phone">Grade</th>
            <th mat-sort-header="role">Gender</th>
            <th mat-sort-header="role">Session</th>
            <th mat-sort-header="createdOn">Admission Date</th>
            <th mat-sort-header="status">Status</th>
            <th class="no-sort">Action</th>
          </tr>
        </thead>
        <tbody>
          @for (data of tableData; track data) {
          <tr>
            <td>
              <div class="userimgname">
                <a href="javascript:void(0);" class="userslist-img bg-img">
                  <img src="data:image/jpeg;base64,{{ data.studentPicture }}" alt="image" style="border-radius: 100%;"
                    onerror="this.onerror=null; this.src='https://www.shareicon.net/data/128x128/2016/05/24/770117_people_512x512.png';" />
                </a>
              </div>
            </td>
            <td>{{ data.admissionNo }}</td>
            <td>{{ data.rollNumber }}</td>
            <td>{{ data.firstName }} {{ data.middleName }} {{ data.lastName }}</td>
            <td>{{ data.grade }} {{ data.gradeSection }}</td>
            <td>{{ data.gender }}</td>
            <td>{{ data.sessionName }}</td>
            <td>{{ data.createdAt | date : "dd-MM-yyyy | HH:mm" }}</td>
            <td>
              <button class="badge-button"
                [ngClass]="{'badge-linesuccess': data.status === 'ACTIVE','badge-linedanger': data.status === 'INACTIVE'}"
                (click)="changeUserStatus(data)">
                {{ data.status }}
              </button>
            </td>
            <td class="action-table-data">
              <div class="edit-delete-action">

                <a class="me-2 p-2 mb-0" data-bs-toggle="modal" data-bs-target="#edit-units"
                  (click)="openEditModal(dialogTemplate, data)">
                  <i class="feather icon-edit feather-edit"></i></a>
                <a class="me-2 confirm-text p-2 mb-0" href="javascript:void(0);" (click)="confirmColor(data.loginId)">
                  <i class="feather icon-trash-2 feather-trash-2"></i></a>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <ng-template #dialogTemplate let-dialog>
    <div class="modalHeaderContainer">
      <h2 mat-dialog-title class="p-0">Update Student Details</h2>
      <div mat-dialog-close class="closeBtn">
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <!-- ================= SCROLLABLE BODY ================= -->
    <mat-dialog-content class="dialog-content">

      <form [formGroup]="editStudentForm" (ngSubmit)="updateStudentForm()">

        <!-- ================= STUDENT DETAILS ================= -->
        <div class="card mb-3">
          <div class="card-body">
            <div class="new-employee-field">
              <div class="card-title-head">
                <h6><span><i class="feather icon-info feather-edit"></i></span>Student Information</h6>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Admission No *</label>
                <input class="form-control" formControlName="admissionNo">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Roll Number *</label>
                <input class="form-control" formControlName="rollNumber">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Grade *</label>
                <input class="form-control" formControlName="grade">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Grade Section</label>
                <input class="form-control" formControlName="gradeSection">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">First Name *</label>
                <input class="form-control" formControlName="firstName">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Middle Name</label>
                <input class="form-control" formControlName="middleName">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Last Name *</label>
                <input class="form-control" formControlName="lastName">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Date of Birth</label>
                <input type="date" class="form-control" formControlName="dob">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Birth Place</label>
                <input class="form-control" formControlName="dobPlace">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Gender</label>
                <select class="form-control" formControlName="gender">
                  <option value="">Select</option>
                  <option>Male</option>
                  <option>Female</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Blood Group</label>
                <input class="form-control" formControlName="bloodGroup">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Nationality</label>
                <input class="form-control" formControlName="nationality">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Category</label>
                <input class="form-control" formControlName="category">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Religion</label>
                <input class="form-control" formControlName="religion">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Aadhaar No</label>
                <input class="form-control" formControlName="aadharNumber">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Birth Certificate No</label>
                <input class="form-control" formControlName="birthCertificateNumber">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">PEN</label>
                <input class="form-control" formControlName="permanentEducationNumber">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">E-Shiksha Unique ID</label>
                <input class="form-control" formControlName="eShikshaUniqueId">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Session</label>
                <input class="form-control" formControlName="sessionName">
              </div>

              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">Sibling Admission No</label>
                <input class="form-control" formControlName="siblingAdmissionNumber">
              </div>
            </div>
          </div>
        </div>

        <!-- ================= PARENTS DETAILS ================= -->
        <div class="card mb-3">
          <div class="card-body">
            <div class="new-employee-field">
              <div class="card-title-head">
                <h6><span><i class="feather icon-info feather-edit"></i></span>Parents Information</h6>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label requiredField">Father Name *</label>
                <input class="form-control" formControlName="fatherName">
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label requiredField">Father Mobile</label>
                <input class="form-control" formControlName="fatherMobileNo">
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label requiredField">Mother Name</label>
                <input class="form-control" formControlName="motherName">
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label requiredField">Mother Mobile</label>
                <input class="form-control" formControlName="motherMobileNo">
              </div>
            </div>
          </div>
        </div>

        <!-- ================= CURRENT ADDRESS ================= -->
        <div class="card mb-3">
          <div class="card-body">

            <div class="new-employee-field">
              <div class="card-title-head">
                <h6><span><i class="feather icon-info feather-edit"></i></span>Current Address</h6>
              </div>
            </div>
            <label class="form-label requiredField">Address</label>
            <textarea class="form-control mb-2" formControlName="currentAddress"></textarea>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">City</label>
                <input class="form-control" formControlName="currentCity">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">State</label>
                <input class="form-control" formControlName="currentState">
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label requiredField">PIN</label>
                <input class="form-control" formControlName="currentPin">
              </div>
            </div>
          </div>
        </div>

        <!-- ================= PERMANENT ADDRESS ================= -->
        <div class="card mb-3">
          <div class="card-body">

            <div class="new-employee-field">
              <div class="card-title-head">
                <h6><span><i class="feather icon-info feather-edit"></i></span>Permanent Address</h6>
              </div>
            </div>

            <textarea class="form-control mb-2" formControlName="permanentAddress"></textarea>

            <div class="row">
              <div class="col-md-4 mb-3">
                <input class="form-control" placeholder="City" formControlName="permanentCity">
              </div>
              <div class="col-md-4 mb-3">
                <input class="form-control" placeholder="State" formControlName="permanentState">
              </div>
              <div class="col-md-4 mb-3">
                <input class="form-control" placeholder="PIN" formControlName="permanentPin">
              </div>
            </div>
          </div>
        </div>

        <!-- ================= PREVIOUS SCHOOL ================= -->
        <div class="card mb-3">
          <div class="card-body">

            <div class="new-employee-field">
              <div class="card-title-head">
                <h6><span><i class="feather icon-info feather-edit"></i></span>Previous School Information</h6>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-4 col-md-6 form-group">
                <div class="mb-3">
                  <label class="form-label requiredField">Previous School</label>
                  <input class="form-control" pInputText type="text" formControlName="previousSchool">
                </div>
              </div>

              <div class="col-md-4 mb-3 form-group">
                <label class="form-label requiredField">Reason for Change</label>
                <input class="form-control" formControlName="reasonForChange">
              </div>
              <div class="col-md-4 mb-3 form-group">
                <label class="form-label requiredField">Last Class Attended</label>
                <input class="form-control" formControlName="lastClassAttended">
              </div>
            </div>

          </div>
        </div>

        <!-- ================= SUBMIT ================= -->
        <div class="text-end">
          <button type="submit" class="btn btn-primary" [disabled]="editStudentForm.invalid">
            Update Student
          </button>
        </div>

      </form>

    </mat-dialog-content>
  </ng-template>